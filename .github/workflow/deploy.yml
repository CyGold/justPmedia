name: Deploy Static Website to Azure Blob Storage

on:
  push:
    branches:
      - main
    paths:
      - 'website/**' 

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: üì• Checkout repository
      uses: actions/checkout@v4

    - name: üîê Login to Azure
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: üì§ Upload static files to Azure Blob Storage
      uses: azure/CLI@v1
      with:
        inlineScript: |
          RESOURCE_GROUP="myResourceGroup"
          STORAGE_ACCOUNT="staticwebprod"
          LOCAL_FOLDER="site"

          echo "üí° Enabling static website (safe to repeat)..."
          az storage blob service-properties update \
            --account-name $STORAGE_ACCOUNT \
            --static-website \
            --index-document index.html

          echo "‚è´ Uploading updated files..."
          az storage blob upload-batch \
            --account-name $STORAGE_ACCOUNT \
            --destination \$web \
            --source $LOCAL_FOLDER \
            --overwrite

          echo "‚úÖ Deployment complete!"
          PUBLIC_URL=$(az storage account show \
            --name $STORAGE_ACCOUNT \
            --query "primaryEndpoints.web" \
            --output tsv)
          echo "üåç Website URL: $PUBLIC_URL"
